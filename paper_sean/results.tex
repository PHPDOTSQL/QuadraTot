% !TEX root =main.tex

All learning in this study took place in simulation, but the ultimate
goal of our evolved gaits was to perform well in reality. Thus, we
compare our learning performance both in simulation and in hardware
(reality) to previous studies where data is available.

\subsubsection{Simulation}

A simulated physical environment provides a noise-free setting for
testing learning algorithms. The resulting gaits in simulation after
learning with HyperNEAT reveal that HyperNEAT is capable of evolving
high fitness and highly organic-looking gaits when many evolutionary
evaluations can be afforded. 

We compared the average fitnesses of 20 learning runs performed in
simulation using HyperNEAT and a GA\footnote{For a more
robust comparison to our 20 runs, we ran 19 more runs with the same
learning settings as used in Kyrre et al. 2012~\cite{glette}, in
addition to the 1 run published.}, with settings used in Glette et
al. 2012~\cite{glette} and found that HyperNEAT outperformed the
latter: $\emph{p} < 6.8\cdot10^{-8}$, comparing the
20 learning runs from both learning methods.\footnote{\emph{p} value generated
with MATLAB's non-parametric Mann-Whitney \emph{U}-test} 
HyperNEAT's gaits are in average of
55\% faster at the final learning generation --- HyperNEAT: mean 25.4
cm/s $\pm$ 3.4 SD, and Genetic Algorithm: mean 16.7 cm/s $\pm$ 1.9 SD
(\tabref{results}).

%Also add: This result
%is even more significant when one considers that the gait produced by
%HyperNEAT with a simulator evolved with 20000 (33\%) fewer evaluations
%per run than Glette et al. 2012, a decision mandated by the available
%computational resources.

\subsubsection{Hardware}

Gaits evolved in simulation in this study and then transferred to a
physical robot outperformed gaits from all previous studies that were
evolved using only hardware evaluations~\cite{yos:clune,haocheng}
(\tabref{results}). The first important result is the confirmation of
the hypothesis proposed earlier: that using a simulator, although
imperfect, can benefit the evolution of gaits for the real world.

The most likely explanation for this benefit is the large difference
in the population size afforded by a simulator (200 for simulation
vs. 9 in hardware) and the number of generations (200 vs. 20), leading
to a total difference in the number of evaluations between the two
studies of 40000 vs 180 per evolutionary run~\cite{yos:clune}. Another
potential cause of improved performance is that with a simulator
HyperNEAT had much less noise in the evaluation process during early
generations: it could thus find coordinated, regular, gaits, which are
both higher-performing and more likely to transfer \edit{Jeff, what do
you think?}. On the physical robot, the noise in the evaluation was
substantial, preventing effective learning and the discovery of
effective gaits~\cite{yos:clune}. Moreover, we cannot rule out that
the addition in this study of a punishment for high-frequency gaits
aided performance, especially since in simulation the gaits were
high-frequency in a few early generations before rapidly settling to a
lower frequency due to the penalty~(\figref{avg_fit_vs_gen},
right). It is possible that quickly leaving the high-frequency area of
the search space caused a significant performance boost.

In addition to showing the benefits of using a simulator, the second
important result is that HyperNEAT is able to find faster real world gaits
than a simpler encoding~\cite{glette} when both are evolved in simulation.

However, comparing performance in hardware between studies performed in
different laboratories is difficult, not only because reality is
inherently noisy, but because even two copies of the same robot are
not identical and may produce different gait speeds for the same input
gait. In particular, one copy of the QuadraTot robot ---
CCML\footnote{Cornell Creative Machines Lab} --- was used to evaluate
gaits for this study and previous studies~\cite{yos:clune,haocheng},
but a different copy of the same robot --- ROBIN\footnote{Robotics and
Intelligent Systems, U. Oslo} --- was used for another
study~\cite{glette}.

The previous fastest gait on any copy of a QuadraTot was from Glette
et al. 2012~\cite{glette} at 17.8 cm/s, as measured on ROBIN. The
fastest gait measured in our study on our robot, CCML, was 14.5
cm/s. It was unclear whether this difference in performance was due to
the differences in the gaits themselves or dissimilarities between
hardware. To control for this possibility, we ran the fastest gait
from \cite{glette} 10 times on CCML and measured an average speed of
only 12.95 cm/s (vs. 17.8 cm/s as measured on ROBIN) and a maximum of
13.76 cm/s (\tabref{results}). Thus, it appears that our robot,
CCML, is slightly slower than ROBIN.

Further, we note that all learning for both this paper
and \cite{glette} was done in simulation, without any influence from
either hardware copy of the robot. Because gaits produced in this
study performed better than all previously recorded gaits on CCML (the only
platform on which they have been compared), we tentatively
conclude that this higher performance would generalize to new copies
of the QuadraTot platform.

\subsubsection{Discussion}

\begin{table}
\begin{center}
\begin{tabular}{|l|r|r|r|r|}
\hline
                                         &              & Simulated  & Real Vel. & Real Vel.  \\
                                         & Evaluations  & Velocity &    (CCML)     & (ROBIN) \\
\hline
Parameterized gaits + optimization \cite{yos:clune}   &153    & --    & 5.8 & --\\
\hline
HyperNEAT in hardware \cite{yos:clune}                 & 180         & --         &   9.7  & --   \\
\hline
RL PoWER Spline \cite{haocheng}                         & 300         & --         &   11.1 & --\\
\hline
GA + simulator \cite{glette}             & 60000       & *16.7       &   13.0   & \textbf{17.8}  \\
\hline
HyperNEAT + simulator [this paper]                     & 40000       & \textbf{25.4}       &   \textbf{14.5} & --\\
\hline
\end{tabular}
\end{center}
\tablabel{results}
\caption{Gait speeds in simulation and on each of two QuadraTot hardware platforms for this paper and three previous studies. We report the number of evaluations per run, simulated (average) and real trial (max) velocities in cm/s. *Instead of using the single fitness value reported in~\cite{glette}, we ran 19 additional runs and used the average fitness of those runs.}  %\tablabel{results}
\end{table}

Qualitatively, the HyperNEAT gaits are regular and coordinated, as has
been found in previous simulation
studies~\cite{clune2009evolving,clune2011performance}. This is evident
in the servo position plots where the gaits produced in this study are
smooth and are similar between the servos~(see \figref{servo_plot_111}
for a representative example). This result is important because it
confirms that HyperNEAT can produce the important property of
regularity in simulation, which was not previously observed when
evolving directly on the hardware~\cite{yos:clune}. HyperNEAT's higher
performance, as well as its higher standard deviation, is likely due
to HyperNEAT exploring and exploiting a greater variation of gaits,
some of which are better than others.

While this study was able to produce the fastest QuadraTot gait to
date, most of the gaits in simulation did not transfer well to
reality. Many gaits that performed very well in simulation performed
poorly on the real robot, largely due to servos that were too weak and
timed out, or because of frictional differences between simulation and
reality. Repeated attempts to minimize these problems were
unsuccessful.  A major, unavoidable cause of the servo shutdowns was
the design of the robot: the force required to lift the robot in many
poses was too much for the servos. Future studies may use a
robot that has more mechanical advantage and requires less torque from
each servo, such as the Aracna platform~\cite{lohmann2012aracna},
which was designed in response to the challenges experienced with the
QuadraTot platform.

\figp{FINAL_kyrre_sean_fitness}{0.92}
{Fitnesses of the champion gaits evolved with HyperNEAT and a genetic
algorithm~\cite{glete} averaged over 20 runs, measured in simulation
as distance travelled over 12 seconds in cm/s. The dashed lines are
standard deviations. HyperNEAT gaits outperformed gaits evolved in
simulation using a genetic algorithm~\cite{glette} by 54.3\% in
simulation and 5.4\% in reality, and they outperformed gaits evolved
using HyperNEAT in hardware by 49.5\% (\tabref{results}).}

\figgp{servo_plot_111}{.48}{frequencyPlotThreshFinal}{.48}
{\textbf{Left: }
Servo positions over time (for nine servos) for a gait produced in
this study. The smoothness, symmetry, and regularities of the gait
show that by using a simulator, HyperNEAT was able to fully exploit
the geometry of the problem.
\textbf{Right: }Average frequencies of the gaits averaged over 20 runs. 
After implementing a policy which
punished gaits with high frequencies to reduce servo shutdowns,
HyperNEAT was able to find high-performing, low frequency
gaits.}










