% !TEX root =main.tex

%We%compare performance in simulation and hardware
%to available data from previous studies.
%\subsubsection{Simulation:}

The simulator enabled HyperNEAT to evolve fast, organic gaits. In
simulation, HyperNEAT gaits (\figref{threeplots}-Top) were
significantly faster than those from Glette et al, $\emph{p-value} <
6.8\times10^{-8}$ when comparing the best gaits in the final
generation of each run via Matlab's Wilcoxon rank sum test.
Specifically, HyperNEAT gaits were 52.1\% faster in simulation (25.4
cm/s $\pm$ 3.4 SD versus 16.7 cm/s $\pm$ 1.9 SD). Note that \tabref{results} reports 
mean $\pm$ SD to make comparison with earlier work~\cite{glette} easier, but qualitative conclusions remain the same even when the analysis is conducted using medians.
Plots of servo positions over time reveal that the evolved HyperNEAT gaits are regular, smooth and coordinated~(\figref{threeplots}-Left), confirming previous results with HyperNEAT in simulation~\cite{clune2011performance,clune2009evolving}.

%\figOneOnTwo[h!]{threeplots}{med_fit_gen}{0.62}{servo_plot_111}{.48}{frequencyPlotThreshFinal}{.48}
\figOneOnTwo[h!]{threeplots}{avg_fit_vs_gen}{0.62}{servo_plot_111}{.48}{frequencyPlotThreshFinal}{.48}
%\figOneOnTwo[h!]{threeplots}{med_fit_gen}{0.00}{servo_plot_111}{.48}{frequencyPlotThreshFinal}{.48}
{
\textbf{Top: }
%HyperNEAT outperforms a genetic algorithm with a simple encoding when both algorithms are combined with a simulator. Plotted are medians over 20 runs in simulation (solid lines) $\pm$ CIs (dashed lines). HyperNEAT gaits are 52.1\% faster in
HyperNEAT outperforms a genetic algorithm with a simple encoding \cite{glette} when both algorithms are combined with a simulator. Plotted are means over 20 runs in simulation (solid lines) $\pm$ SD (dashed lines). HyperNEAT gaits are 52.1\% faster in
simulation and 5.1\% faster in reality than those from a previous study \cite{glette}~(details in \tabref{results}).
\textbf{Left: }
Servo positions over time (for nine servos) for a representative simulated HyperNEAT gait. HyperNEAT produced smooth and symmetrical gaits that contained complex regularities. 
\textbf{Right: }Mean gait frequency averaged over 20 runs. 
Gaits with frequencies above a threshold (horizontal line) receive a fitness penalty. HyperNEAT quickly learned to produce gaits with frequencies low enough to avoid this penalty.
}


On the physical robot, HyperNEAT gaits from this study outperformed gaits from all previous QuadraTot studies~(\tabref{results})~\cite{yos:clune,glette,haocheng}, including those of Glette et al. 
 However, comparing performance in hardware between studies performed in
different laboratories is difficult, not only because reality is
inherently noisy, but because even two copies of the same robot are
not identical and may produce different speeds for the same input
gait. Gaits for this study and two previous studies~\cite{yos:clune,haocheng} were evaluated on a copy of the QuadraTot robot in the Cornell Creative Machines Lab (CCML), while the gaits in Glette et al. were evaluated on a different copy of the same robot in the Robotics and
Intelligent Systems (ROBIN) lab at the University of Oslo. The two robots were evaluated on two different surfaces, and had different material enveloping their feet to increase friction (compare \figref{quadratotWhiteBooties}-Left to Figure 2 of Glette et al). 

The previous fastest gait on any copy of a QuadraTot was from Glette
et al., and traveled 17.8 cm/s on the ROBIN QuadraTot. The
fastest gait produced by HyperNEAT with a simulator in the experiments for this paper traveled 14.5
cm/s on the CCML QuadraTot. It was unclear whether this difference in performance was due to
the differences in the gaits themselves or dissimilarities between
hardware. To control for this possibility, we ran the fastest gait
from Glette et al. 10 times on CCML and measured an average speed of
only 12.95 cm/s $\pm0.93$ SD (vs. 17.8 cm/s measured on ROBIN) and a maximum of
13.8 cm/s (\tabref{results}). It thus appears that the CCML version of the robot is slower. Moreover, the HyperNEAT gait (14.5 cm/s) is faster than the best gait of Glette et al. on the CCML QuadraTot. Unfortunately, it was not possible to test the best HyperNEAT gait on the ROBIN QuadraTot. Because HyperNEAT outperformed the simple encoding from Glette et al. on the same robotic hardware, we tentatively
conclude that HyperNEAT produces faster gaits for the QuadraTot robot. This conclusion is supported by the fact that HyperNEAT also outperformed the encoding from Glette et al. in simulation. 

\begin{table}
\begin{center}
\begin{tabular}{|l|r|r|r|r|}
\hline
                                         &              & Simulated  & Real Vel. & Real Vel.  \\
                                         & Evaluations  & Velocity &    (CCML)     & (ROBIN) \\
\hline
Parameterized gaits + optimization \cite{yos:clune}   &153    & --    & 5.8 & --\\
\hline
HyperNEAT in hardware \cite{yos:clune}                 & 180         & --         &   9.7  & --   \\
\hline
RL PoWER Spline \cite{haocheng}                         & 300         & --         &   11.1 & --\\
\hline
GA + simulator \cite{glette}             & 60000       & *16.7       &   13.8   & \textbf{17.8}  \\
\hline
HyperNEAT + simulator [this paper]                     & 40000       & \textbf{**25.4}       &   \textbf{14.5} & --\\
\hline
\end{tabular}
\vspace{.35cm}
\caption{Velocities of evolved gaits in simulation and on two different copies of the QuadraTot robot. Subject to availability, data are reported from the experiments for this paper and three previous studies. Reported are the total number of evaluations per run, the average of the fastest gaits produced in each run in simulation, and the single fastest gait produced on the CCML and ROBIN copies of the QuadraTot robot (see text for their differences). *Instead of using the single fitness value reported in~\cite{glette}, we ran 19 additional runs and used the average fitness of those 20 runs. Velocities are in cm/s, and bold indicates the best performance. **Fitness median 26.9 cm/s, 95\% confidence interval [23.8 cm/s, 26.75 cm/s].}  
\tablabel{results}
\end{center}
\end{table}

We now discuss the differences between the gaits evolved by HyperNEAT directly on the physical robot~\cite{yos:clune}, and those first evolved in a simulator and then transferred to the robot (this study). 
On the physical robot, the gaits produced by HyperNEAT with a simulator were faster, more natural, and more repeatable than those evolved directly on the QuadraTot robot~\cite{yos:clune}. The gaits were also more regular, as they were in simulation~(\figref{threeplots}-Left). This result is important because it confirms that HyperNEAT can produce the important property of
regularity in a challenging, real-world domain, which was not previously observed when
evolving directly on the hardware~\cite{yos:clune}. Producing regular solutions is a key to exploiting regularity in difficult engineering problems~\cite{clune2011performance}. 


The simulator likely improved performance because of the number of evaluations it enabled, both in terms of the population size (200 vs. 9) and the number of generations (200 vs. 20), leading
to a total difference of 40000 vs 180 per evolutionary run compared to Yosinski et al.~\cite{yos:clune}. Another
potential cause of improved performance is that with a simulator
HyperNEAT had much less noise in the evaluation process and could thus find coordinated, regular, gaits, which perform better. On the physical robot, the noise in the evaluation was
substantial, preventing effective learning~\cite{yos:clune}. 
We performed 20 runs in simulation with the same evaluation samples as 
in Yosinski et al.~\cite{yos:clune} and saw that simulated gaits performed
slightly better than the hardwared learned gaits ($p < 0.1571$, mean fitness 7.9 cm/s).
This supports the noise hypothesis, but suggests that the number of evaluations performed is a more likely explanation.
The encouragement of low-frequency gaits in this study
also may have aided performance, especially since in simulation the gaits were
high-frequency in a few early generations before rapidly settling to a
 range below the penalized threshold~(\figref{threeplots}-Right).



While this study was able to produce the fastest QuadraTot gait to
date, most of the gaits in simulation did not transfer well to
reality. Many gaits that were fast in simulation performed
poorly on the real robot, largely due to servos that were too weak and
shut down, or because of differences between simulation and
reality. Repeated attempts to minimize these problems were
unsuccessful. 
%A major, unavoidable cause of the servo shutdowns was
%the design of the robot: the force required to lift the robot in many
%poses was too much for the servos. 
In future studies we will use a
robot that has more mechanical advantage and requires less torque from
each servo, such as the Aracna platform~\cite{lohmann2012aracna}.
%which was designed in response to the challenges experienced with the
%QuadraTot platform. 
That we did not model the servos in simulation, especially with their frequent failures, suggests that even better results could be obtained via a simulator that contained or learned servo models. In future work we will also incorporate techniques to minimize the gap between the simulator and reality~\cite{koos2010crossing,bongard,zagal,koos2011transferability}.
